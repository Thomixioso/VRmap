<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Pokročilé VR Ovládání 2D Mapy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; cursor: none; background: #333; }
        #map { width: 100%; height: 100%; }

        /* Vylepšení pro mapové panely, aby na ně šly aplikovat filtry */
        .leaflet-tile-pane { transition: filter 0.1s linear; }

        .controls {
            position: absolute; top: 10px; right: 10px; z-index: 1000;
            background: rgba(0, 0, 0, 0.8); color: white; padding: 15px; border-radius: 8px;
            border: 1px solid #4a90e2; font-family: sans-serif; max-height: 95%; overflow-y: auto;
        }
        .control-group { margin-bottom: 15px; border-top: 1px solid #555; padding-top: 10px; }
        .control-group h5 { margin: 0 0 10px 0; color: #4a90e2; }
        .controls label { display: block; margin-bottom: 5px; font-size: 14px; }
        .controls input[type="range"] { width: 200px; }

        .laser-pointer {
            position: fixed; width: 20px; height: 20px;
            background: radial-gradient(circle, #ff0000 0%, #ff0000 40%, transparent 70%);
            border: 2px solid #ff0000; border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none; z-index: 9999;
            transition: transform 0.1s ease-out, background 0.1s, border-color 0.1s;
        }
        /* Nový stav pro "chycení" slideru */
        .laser-pointer.grabbing {
            transform: translate(-50%, -50%) scale(1.5);
            background: radial-gradient(circle, #4a90e2 0%, #4a90e2 40%, transparent 70%);
            border-color: #4a90e2;
        }
    </style>
</head>
<body>

    <div id="map"></div>
    <div class="laser-pointer"></div>

    <div class="controls" id="controlsPanel">
        <h4>Ovládání vrstev</h4>
        <div class="control-group">
            <h5>Překryvná vrstva (Overlay)</h5>
            <label>Průhlednost: <span id="overlayOpacityVal">0.7</span></label>
            <input type="range" id="overlayOpacity" min="0" max="1" step="0.01" value="0.7">
            <label>Jas: <span id="overlayBrightnessVal">100</span>%</label>
            <input type="range" id="overlayBrightness" min="0" max="200" step="1" value="100">
            <label>Kontrast: <span id="overlayContrastVal">100</span>%</label>
            <input type="range" id="overlayContrast" min="0" max="200" step="1" value="100">
            <label>Sytost: <span id="overlaySaturateVal">100</span>%</label>
            <input type="range" id="overlaySaturate" min="0" max="200" step="1" value="100">
            <label>Odstín: <span id="overlayHueVal">0</span>°</label>
            <input type="range" id="overlayHue" min="0" max="360" step="1" value="0">
        </div>
        <div class="control-group">
            <h5>Podkladová vrstva (Base)</h5>
            <label>Jas: <span id="baseBrightnessVal">100</span>%</label>
            <input type="range" id="baseBrightness" min="0" max="200" step="1" value="100">
            <label>Kontrast: <span id="baseContrastVal">100</span>%</label>
            <input type="range" id="baseContrast" min="0" max="200" step="1" value="100">
            <label>Sytost: <span id="baseSaturateVal">100</span>%</label>
            <input type="range" id="baseSaturate" min="0" max="200" step="1" value="100">
            <label>Odstín: <span id="baseHueVal">0</span>°</label>
            <input type="range" id="baseHue" min="0" max="360" step="1" value="0">
        </div>
    </div>

<script>
    // 1. NASTAVENÍ MAPY A VRSTEV
    const map = L.map('map', { zoomControl: false }).setView([49.8, 15.5], 8);
    const baseLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}').addTo(map);
    const overlayLayer = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png').addTo(map);

    const basePane = baseLayer.getPane();
    const overlayPane = overlayLayer.getPane();

    // 2. LOGIKA PRO "VR" OVLÁDÁNÍ
    const laserPointer = document.querySelector('.laser-pointer');
    let activeSlider = null;
    let isDragging = false;

    document.addEventListener('mousemove', (e) => {
        laserPointer.style.left = `${e.clientX}px`;
        laserPointer.style.top = `${e.clientY}px`;

        if (isDragging && activeSlider) {
            const sliderRect = activeSlider.getBoundingClientRect();
            let newValueRatio = (e.clientX - sliderRect.left) / sliderRect.width;
            newValueRatio = Math.max(0, Math.min(1, newValueRatio));

            const min = parseFloat(activeSlider.min);
            const max = parseFloat(activeSlider.max);
            activeSlider.value = min + newValueRatio * (max - min);
            
            // Vyvolá 'input' událost, aby se změny projevily v reálném čase
            activeSlider.dispatchEvent(new Event('input', { bubbles: true }));
        }
    });

    document.addEventListener('mousedown', (e) => {
        // Cílíme pouze na prvky typu 'range' uvnitř našeho panelu
        if (e.target.type === 'range') {
            isDragging = true;
            activeSlider = e.target;
            laserPointer.classList.add('grabbing'); // Vizuální zpětná vazba
            e.preventDefault();
        }
    });

    document.addEventListener('mouseup', () => {
        if (isDragging) {
            isDragging = false;
            activeSlider = null;
            laserPointer.classList.remove('grabbing'); // Ukončení zpětné vazby
        }
    });

    // 3. CENTRÁLNÍ FUNKCE PRO APLIKACI ZMĚN
    const controlsPanel = document.getElementById('controlsPanel');

    function updateMapEffects() {
        // Aplikace průhlednosti
        const opacity = document.getElementById('overlayOpacity').value;
        overlayLayer.setOpacity(opacity);
        document.getElementById('overlayOpacityVal').textContent = parseFloat(opacity).toFixed(2);

        // Sestavení CSS filtrů pro překryvnou vrstvu
        const oBrightness = document.getElementById('overlayBrightness').value;
        const oContrast = document.getElementById('overlayContrast').value;
        const oSaturate = document.getElementById('overlaySaturate').value;
        const oHue = document.getElementById('overlayHue').value;
        overlayPane.style.filter = `
            brightness(${oBrightness}%) 
            contrast(${oContrast}%) 
            saturate(${oSaturate}%) 
            hue-rotate(${oHue}deg)
        `;
        document.getElementById('overlayBrightnessVal').textContent = oBrightness;
        document.getElementById('overlayContrastVal').textContent = oContrast;
        document.getElementById('overlaySaturateVal').textContent = oSaturate;
        document.getElementById('overlayHueVal').textContent = oHue;

        // Sestavení CSS filtrů pro podkladovou vrstvu
        const bBrightness = document.getElementById('baseBrightness').value;
        const bContrast = document.getElementById('baseContrast').value;
        const bSaturate = document.getElementById('baseSaturate').value;
        const bHue = document.getElementById('baseHue').value;
        basePane.style.filter = `
            brightness(${bBrightness}%) 
            contrast(${bContrast}%) 
            saturate(${bSaturate}%) 
            hue-rotate(${bHue}deg)
        `;
        document.getElementById('baseBrightnessVal').textContent = bBrightness;
        document.getElementById('baseContrastVal').textContent = bContrast;
        document.getElementById('baseSaturateVal').textContent = bSaturate;
        document.getElementById('baseHueVal').textContent = bHue;
    }

    // Posloucháme změny na celém panelu najednou
    controlsPanel.addEventListener('input', updateMapEffects);

    // Zavoláme funkci poprvé, aby se nastavily výchozí hodnoty
    updateMapEffects();

</script>

</body>
</html>
