<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>PoC: VR Ovládání 2D Mapy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; cursor: none; background: #333; }
        #map { width: 100%; height: 100%; }
        
        /* Ovládací panel z tvé mapy */
        .controls {
            position: absolute; top: 20px; right: 20px; z-index: 1000;
            background: rgba(0, 0, 0, 0.8); color: white; padding: 15px; border-radius: 8px;
            border: 1px solid #4a90e2; font-family: sans-serif;
        }
        .controls label { display: block; margin-bottom: 5px; }
        .controls input[type="range"] { width: 200px; }

        /* "Laser" z VR prostředí */
        .laser-pointer {
            position: fixed; width: 20px; height: 20px;
            background: radial-gradient(circle, #ff0000 0%, #ff0000 40%, transparent 70%);
            border: 2px solid #ff0000; border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none; /* Důležité, aby neblokoval kliknutí */
            z-index: 9999;
        }
    </style>
</head>
<body>

    <div id="map"></div>
    <div class="laser-pointer"></div>

    <div class="controls">
        <h4>Ovládání vrstvy</h4>
        <label for="opacitySlider">Průhlednost (Opacity)</label>
        <input type="range" id="opacitySlider" min="0" max="1" step="0.01" value="0.7">
    </div>

<script>
    // 1. ZÁKLADNÍ NASTAVENÍ MAPY
    const map = L.map('map', { zoomControl: false }).setView([49.8, 15.5], 8);
    const baseLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
    }).addTo(map);
    const overlayLayer = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
        maxZoom: 17,
        attribution: 'Map data: &copy; OpenStreetMap contributors, SRTM | Map style: &copy; OpenTopoMap (CC-BY-SA)'
    }).addTo(map);

    const opacitySlider = document.getElementById('opacitySlider');
    overlayLayer.setOpacity(opacitySlider.value);


    // 2. LOGIKA PRO "VR" OVLÁDÁNÍ SLIDERU
    const laserPointer = document.querySelector('.laser-pointer');
    let activeSlider = null;
    let isDragging = false;

    // Sledování pozice "laseru" (kurzoru myši)
    document.addEventListener('mousemove', (e) => {
        laserPointer.style.left = `${e.clientX}px`;
        laserPointer.style.top = `${e.clientY}px`;

        if (isDragging && activeSlider) {
            // Získání rozměrů a pozice slideru
            const sliderRect = activeSlider.getBoundingClientRect();
            // Výpočet nové hodnoty na základě pozice myši relativně ke slideru
            let newValue = (e.clientX - sliderRect.left) / sliderRect.width;
            
            // Omezení hodnoty mezi 0 a 1
            newValue = Math.max(0, Math.min(1, newValue));

            // Přepočet na rozsah min/max daného slideru
            const min = parseFloat(activeSlider.min);
            const max = parseFloat(activeSlider.max);
            activeSlider.value = min + newValue * (max - min);

            // Spuštění 'input' události, aby se změna projevila
            activeSlider.dispatchEvent(new Event('input'));
        }
    });

    // "Chytnutí" slideru
    document.addEventListener('mousedown', (e) => {
        if (e.target.type === 'range') {
            isDragging = true;
            activeSlider = e.target;
            // Zabráníme výchozímu chování, aby se slider nepřetahoval dvakrát
            e.preventDefault();
        }
    });

    // "Puštění" slideru
    document.addEventListener('mouseup', () => {
        isDragging = false;
        activeSlider = null;
    });

    // 3. PROPOJENÍ SLIDERU S MAPOU
    opacitySlider.addEventListener('input', (e) => {
        overlayLayer.setOpacity(e.target.value);
    });

</script>

</body>
</html>
