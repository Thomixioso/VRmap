<!DOCTYPE html>
<html>
<head>
    <title>A-Frame Stereo - Insta 360 EVO</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="build.js"></script>
    
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        .debug {
            position: fixed; top: 10px; left: 10px;
            background: rgba(0,0,0,0.8); color: white;
            padding: 10px; border-radius: 5px;
            font-family: monospace; font-size: 12px;
            z-index: 1000; max-width: 400px;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        button {
            background: #007bff; color: white; border: none;
            padding: 8px 16px; margin: 5px; border-radius: 3px; cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="debug" id="debugOutput">
        <strong>ü•Ω A-Frame Stereo - build.js knihovna</strong><br>
        <span id="status">Naƒç√≠t√°m...</span><br>
        <button onclick="toggleDebug()">Skr√Ωt/Zobrazit</button>
    </div>

    <a-scene antialias="true">
        <!-- Rozdƒõlen√© poloviny z Insta 360 EVO obr√°zku -->
        <a-assets>
            <img id="originalImage" src="./Castles/generated/Le_Castillet_generated.jpg">
            <canvas id="left" width="1024" height="1024"></canvas>
            <canvas id="right" width="1024" height="1024"></canvas>
        </a-assets>

        <!-- Camera -->
        <a-entity camera look-controls position="0 0 0" stereocam="eye:left;"></a-entity>

        <!-- Sky sphere -->
        <a-sky id="sky1" src="#left" stereo="eye:left"></a-sky>
        <a-sky id="sky2" src="#right" stereo="eye:right"></a-sky>
    </a-scene>

    <script>
        function log(message, type = 'info') {
            const status = document.getElementById('status');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            status.innerHTML += `<div class="${className}">${message}</div>`;
            console.log(message);
        }
        
        function toggleDebug() {
            const debug = document.querySelector('.debug');
            debug.style.display = debug.style.display === 'none' ? 'block' : 'none';
        }
        
        function splitStereoToCanvases() {
            const img = document.getElementById('originalImage');
            const leftCanvas = document.getElementById('left');
            const rightCanvas = document.getElementById('right');
            
            if (!img.complete) {
                log('‚ùå Obr√°zek nen√≠ naƒçten', 'error');
                return;
            }
            
            const fullWidth = img.naturalWidth;
            const fullHeight = img.naturalHeight;
            const halfWidth = fullWidth / 2;
            
            log(`üìè Celkov√Ω obr√°zek: ${fullWidth}x${fullHeight}`, 'info');
            log(`üîÑ Lev√° polovina: 0-${halfWidth}, Prav√°: ${halfWidth}-${fullWidth}`, 'info');
            
            // Nastavit velikost canvas
            leftCanvas.width = halfWidth;
            leftCanvas.height = fullHeight;
            rightCanvas.width = halfWidth;
            rightCanvas.height = fullHeight;
            
            const leftCtx = leftCanvas.getContext('2d');
            const rightCtx = rightCanvas.getContext('2d');
            
            try {
                // Lev√° polovina obr√°zku ‚Üí left canvas
                leftCtx.drawImage(img, 0, 0, halfWidth, fullHeight, 0, 0, halfWidth, fullHeight);
                
                // Prav√° polovina obr√°zku ‚Üí right canvas
                rightCtx.drawImage(img, halfWidth, 0, halfWidth, fullHeight, 0, 0, halfWidth, fullHeight);
                
                log('‚úÖ Side-by-side rozdƒõlen na L/R canvas!', 'success');
                log('ü•Ω build.js stereo komponenty p≈ôipraveny', 'success');
                log('üëÜ Kliknƒõte VR tlaƒç√≠tko vpravo dole', 'success');
            } catch (error) {
                log(`‚ùå Chyba p≈ôi rozdƒõlen√≠: ${error.message}`, 'error');
            }
        }
        
        // Inicializace
        window.addEventListener('load', () => {
            log('üöÄ Spou≈°t√≠m s build.js knihovnou...', 'info');
            
            const img = document.getElementById('originalImage');
            
            img.addEventListener('load', () => {
                log('‚úÖ Insta 360 EVO obr√°zek naƒçten', 'success');
                splitStereoToCanvases();
            });
            
            img.addEventListener('error', () => {
                log('‚ùå Chyba naƒç√≠t√°n√≠ obr√°zku', 'error');
                log('Zkontrolujte cestu: ./Castles/generated/Le_Castillet_generated.jpg', 'error');
            });
            
            // Pokud u≈æ je naƒçten
            if (img.complete && img.naturalWidth > 0) {
                img.dispatchEvent(new Event('load'));
            }
        });
    </script>
</body>
</html>
