<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mapa zaj√≠mav√Ωch m√≠st</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script type="module" src="https://stereo-img.steren.fr/stereo-img.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background-color: #f5f5f5;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    overflow: hidden;
  }

  .header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    text-align: center;
  }

  #map { 
    height: 65vh; 
    width: 100%; 
  }

  #imageContainer { 
    padding: 20px;
    text-align: center;
    min-height: 250px;
    background: #f8f9fa;
  }

  #imageContainer img { 
    max-width: 100%; 
    max-height: 400px;
    height: auto; 
    border: 2px solid #dee2e6;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }

  /* VR overlay container */
  #vrContainer {
    display: none; /* v√Ωchoz√≠ skryto */
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: black;
    z-index: 10000;
  }

  #vrContainer.active {
    display: block; /* kdy≈æ je aktivn√≠ VR */
  }

  /* Overlay tlaƒç√≠tko Exit */
  .vr-controls {
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 10001;
  }

  .vr-exit-btn {
    background: #dc3545;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  .vr-exit-btn:hover {
    background: #c82333;
  }

  /* Vizualizace ovladaƒç≈Ø - jednoduch√© svg nebo divy */
  #controllersOverlay {
    position: absolute;
    top: 20%;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 40px;
    z-index: 10;
    pointer-events: none; /* aby neblokovalo kliky, pokud nechceme interakci */
  }

  .controller {
    width: 80px; height: 150px;
    position: relative;
  }

  /* Vizu√°ln√≠ tlaƒç√≠tka na ovladaƒçi (uk√°zka) */
  .button {
    width: 20px; height: 20px;
    background: #888;
    border-radius: 50%;
    position: absolute;
    cursor: pointer;
    transition: background 0.2s;
  }
  /* Um√≠stƒõn√≠ tlaƒç√≠tek (pouze ilustrace) */
  .button.a { top: 50px; right: 10px; }
  .button.b { top: 80px; right: 10px; }
  .button.x { top: 50px; left: 10px; }
  .button.y { top: 80px; left: 10px; }

  /* Zv√Ωraznƒõn√≠ p≈ôi stisku */
  .button.pressed {
    background: #0f0;
  }

  /* Dal≈°√≠ vizu√°ln√≠ prvky ovladaƒçe (m≈Ø≈æe b√Ωt SVG nebo obr√°zek) */
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üó∫Ô∏è Mapa zaj√≠mav√Ωch m√≠st</h1>
    <p>Prozkoumejte zaj√≠mav√° m√≠sta po cel√©m svƒõtƒõ</p>
  </div>

  <div class="stats">
    <div class="stat-item">
      <strong id="totalLocations">0</strong>
      <div>Celkem m√≠st</div>
    </div>
    <div class="stat-item">
      <strong id="selectedLocation">≈Ω√°dn√©</strong>
      <div>Vybran√© m√≠sto</div>
    </div>
  </div>

  <div id="map"></div>

  <div id="imageContainer">
    <div class="loading">üåç Kliknƒõte na marker na mapƒõ pro zobrazen√≠ informac√≠ a obr√°zku</div>
  </div>
</div>

<!-- VR Container s overlay tlaƒç√≠tkem Exit a vizualizac√≠ ovladaƒç≈Ø -->
<div id="vrContainer">
  <!-- Overlay tlaƒç√≠tko Exit -->
  <div class="vr-controls">
    <button class="vr-exit-btn" onclick="exitVR()">Exit</button>
  </div>
  <!-- Vizualizace ovladaƒç≈Ø -->
  <div id="controllersOverlay">
    <!-- Ilustrace ovladaƒç≈Ø (jednoduch√© divy nebo SVG) -->
    <div class="controller">
      <div class="button x"></div>
      <div class="button y"></div>
    </div>
    <div class="controller">
      <div class="button a"></div>
      <div class="button b"></div>
    </div>
  </div>
  <!-- Stereo obsah -->
  <div class="stereo-container"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let map;
let markersData = [];

// Kategorie s barvami
const categoryColors = {
  'P≈ô√≠rodn√≠ pam√°tka': '#28a745',
  'Historick√° pam√°tka': '#dc3545',
  'Mƒõsto': '#007bff',
  'Hrad': '#6f42c1',
  'Chr√°m': '#fd7e14',
  'Dal≈°√≠': '#6c757d'
};

// Inicializace mapy
function initMap() {
  if (map) {
    map.remove();
  }
  map = L.map('map').setView([50.0755, 14.4378], 6);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap contributors'
  }).addTo(map);
}

// Naƒçten√≠ dat
async function loadData() {
  try {
    const response = await fetch('data.json');
    if (!response.ok) throw new Error(`HTTP error! ${response.status}`);
    const data = await response.json();
    markersData = data;
    updateStats();
    addMarkersToMap();
  } catch (error) {
    document.getElementById('imageContainer').innerHTML =
      `<div class="error-message">
        <strong>Chyba p≈ôi naƒç√≠t√°n√≠ dat:</strong> ${error.message}
        <br>Zkontrolujte, zda existuje soubor data.json ve stejn√© slo≈æce.
      </div>`;
  }
}

function updateStats() {
  document.getElementById('totalLocations').textContent = markersData.length;
}

function addMarkersToMap() {
  markersData.forEach((location, index) => {
    const marker = L.marker([location.lat, location.lon]).addTo(map);
    marker.bindPopup(`
      <div style="text-align: center; min-width: 200px;">
        <h3 style="margin: 0 0 10px 0; color: #333;">${location.name}</h3>
        <p style="margin: 5px 0; color: #666;">${location.description}</p>
        <div style="margin: 10px 0;">
          <span class="category-badge" style="background-color: ${categoryColors[location.category] || categoryColors['Dal≈°√≠']}">
            ${location.category}
          </span>
        </div>
        <button onclick="showLocationDetails(${index})" 
                style="background: #007bff; color: white; border: none; padding: 8px 16px; 
                       border-radius: 4px; cursor: pointer; margin-top: 10px;">
          Zobrazit detail
        </button>
      </div>
    `);
    marker.on('click', () => showLocationDetails(index));
  });
}

function showLocationDetails(index) {
  const location = markersData[index];
  if (!location) return;
  document.getElementById('selectedLocation').textContent = location.name;
  const imageContainer = document.getElementById('imageContainer');
  imageContainer.innerHTML = `
    <div class="location-info">
      <h2 style="color: #333; margin-top: 0;">${location.name}</h2>
      <div class="coordinates">
        üìç ${location.lat.toFixed(4)}, ${location.lon.toFixed(4)}
      </div>
      <div style="margin: 10px 0;">
        <span class="category-badge" style="background-color: ${categoryColors[location.category] || categoryColors['Dal≈°√≠']}">
          ${location.category}
        </span>
      </div>
      <p style="color: #666; line-height: 1.6;">${location.description}</p>
      <img src="${location.image}" 
           alt="${location.name}" 
           style="max-width: 100%; max-height: 400px; height: auto; 
                  border: 2px solid #dee2e6; border-radius: 8px; 
                  box-shadow: 0 4px 8px rgba(0,0,0,0.1); cursor: pointer;"
           onclick="openVRView('${location.image}')"
           onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
      <div style="display: none; color: #dc3545; padding: 20px; 
                  background: #f8d7da; border: 1px solid #f5c6cb; 
                  border-radius: 5px; margin: 10px 0;">
        ‚ö†Ô∏è Obr√°zek se nepoda≈ôilo naƒç√≠st: ${location.image}
      </div>
    </div>
  `;
  // automatick√© otev≈ôen√≠ VR
  openVRView(location.image);
}

function openVRView(imagePath) {
  const vrContainer = document.getElementById('vrContainer');
  const stereoContainer = vrContainer.querySelector('.stereo-container');
  stereoContainer.innerHTML = `<stereo-img src="${imagePath}"></stereo-img>`;
  vrContainer.classList.add('active');
  // spustit kontrolu gamepad≈Ø
  window.requestAnimationFrame(checkGamepads);
}

// Funkce pro ukonƒçen√≠ VR
function exitVR() {
  const vrContainer = document.getElementById('vrContainer');
  vrContainer.classList.remove('active');
  const stereoContainer = vrContainer.querySelector('.stereo-container');
  stereoContainer.innerHTML = '';
}

// Kontrola gamepad≈Ø a vizu√°ln√≠ch tlaƒç√≠tek ovladaƒç≈Ø
function checkGamepads() {
  const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];
  for (let gp of gamepads) {
    if (gp) {
      // Mapov√°n√≠ tlaƒç√≠tek: A=0, B=1, X=2, Y=3
      if (gp.buttons[0]?.pressed || gp.buttons[1]?.pressed || gp.buttons[2]?.pressed || gp.buttons[3]?.pressed) {
        // Zobrazit vizu√°ln√≠ ovladaƒçe p≈ôi stisknut√≠
        updateControllerVisuals(gp);
        // Ukonƒçit VR p≈ôi stisknut√≠ tlaƒç√≠tek
        exitVR();
        return;
      } else {
        // Pokud tlaƒç√≠tko nen√≠ stisknut√©, obnovit vizu√°l
        updateControllerVisuals(gp, false);
      }
    }
  }
  if (document.querySelector('#vrContainer').classList.contains('active')) {
    requestAnimationFrame(checkGamepads);
  }
}

// Funkce pro vizu√°ln√≠ zobrazen√≠ ovladaƒç≈Ø
function updateControllerVisuals(gp, pressed = true) {
  // Tady m≈Ø≈æete p≈ôidat logiku, kter√° zmƒõn√≠ barvu tlaƒç√≠tek podle stisknut√≠
  // Nap≈ô√≠klad mƒõnit t≈ô√≠du "pressed" na elementech
  // V tomto jednoduch√©m p≈ô√≠kladu pouze vyp√≠≈°eme do konzole
  // nebo aktualizujeme t≈ô√≠du "pressed" na elementech
  // (zde je jednoduch√Ω p≈ô√≠klad - implementujte podle pot≈ôeby)
}

// P≈ôidat posluchaƒç kl√°vesy Escape pro ukonƒçen√≠ VR
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    if (document.querySelector('#vrContainer').classList.contains('active')) {
      exitVR();
    }
  }
});

// Inicializace
document.addEventListener('DOMContentLoaded', () => {
  initMap();
  loadData();
});
</script>
</body>
</html>
