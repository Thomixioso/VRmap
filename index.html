<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mapa zaj√≠mav√Ωch m√≠st</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script type="module" src="https://stereo-img.steren.fr/stereo-img.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background-color: #f5f5f5;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    overflow: hidden;
  }
  
  .header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    text-align: center;
  }
  
  .stats {
    padding: 15px;
    background: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
    text-align: center;
  }
  
  .stat-item {
    display: inline-block;
    margin: 0 15px;
    padding: 5px 10px;
    background: white;
    border-radius: 5px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  #map { 
    height: 65vh; 
    width: 100%; 
  }
  
  #imageContainer { 
    padding: 20px;
    text-align: center;
    min-height: 250px;
    background: #f8f9fa;
  }
  
  #imageContainer img { 
    max-width: 100%; 
    max-height: 400px;
    height: auto; 
    border: 2px solid #dee2e6;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  
  .location-info {
    background: white;
    padding: 20px;
    margin: 10px auto;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    max-width: 600px;
  }
  
  .coordinates {
    color: #6c757d;
    font-size: 0.9em;
    margin: 10px 0;
    font-family: monospace;
    background: #f1f1f1;
    padding: 5px 8px;
    border-radius: 3px;
    display: inline-block;
  }
  
  .category-badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.8em;
    font-weight: bold;
    color: white;
    margin: 5px 0;
  }
  
  .error-message {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
    padding: 15px;
    border-radius: 5px;
    margin: 20px;
  }
  
  .loading {
    text-align: center;
    padding: 20px;
    color: #6c757d;
  }
  
  /* VR Stereo viewer styles */
  #vrContainer {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: black;
    z-index: 10000;
  }
  
  #vrContainer.active {
    display: block;
  }
  
  .vr-controls {
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 10001;
  }
  
  .vr-exit-btn {
    background: #dc3545;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  
  .vr-exit-btn:hover {
    background: #c82333;
  }
  
  .stereo-container {
    width: 100%;
    height: 100%;
  }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üó∫Ô∏è Mapa zaj√≠mav√Ωch m√≠st</h1>
    <p>Prozkoumejte zaj√≠mav√° m√≠sta po cel√©m svƒõtƒõ</p>
  </div>
  
  <div class="stats">
    <div class="stat-item">
      <strong id="totalLocations">0</strong>
      <div>Celkem m√≠st</div>
    </div>
    <div class="stat-item">
      <strong id="selectedLocation">≈Ω√°dn√©</strong>
      <div>Vybran√© m√≠sto</div>
    </div>
  </div>
  
  <div id="map"></div>
  
  <div id="imageContainer">
    <div class="loading">üåç Kliknƒõte na marker na mapƒõ pro zobrazen√≠ informac√≠ a obr√°zku</div>
  </div>
</div>

<!-- VR Container -->
<div id="vrContainer">
  <div class="vr-controls">
    <button class="vr-exit-btn" onclick="exitVR()">Exit VR</button>
  </div>
  <div class="stereo-container"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let map;
let markersData = [];

// Kategorie s barvami
const categoryColors = {
  'P≈ô√≠rodn√≠ pam√°tka': '#28a745',
  'Historick√° pam√°tka': '#dc3545', 
  'Mƒõsto': '#007bff',
  'Hrad': '#6f42c1',
  'Chr√°m': '#fd7e14',
  'Dal≈°√≠': '#6c757d'
};

// Inicializace mapy s topografickou vrstvou
function initMap() {
  map = L.map('map').setView([50.0755, 14.4378], 6);
  
  // Topografick√° mapa
  L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
    attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
  }).addTo(map);
}

// Naƒçten√≠ dat
async function loadData() {
  try {
    const response = await fetch('data.json');
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    const data = await response.json();
    markersData = data;
    


    updateStats();
    addMarkersToMap();
    
  } catch (error) {
    console.error('Chyba p≈ôi naƒç√≠t√°n√≠ dat:', error);
    document.getElementById('imageContainer').innerHTML = 
      `<div class="error-message">
        <strong>Chyba p≈ôi naƒç√≠t√°n√≠ dat:</strong> ${error.message}
        <br>Zkontrolujte, zda existuje soubor data.json ve stejn√© slo≈æce.
      </div>`;
  }
}

// Aktualizace statistik
function updateStats() {
  document.getElementById('totalLocations').textContent = markersData.length;
}

// P≈ôid√°n√≠ marker≈Ø na mapu
function addMarkersToMap() {
  markersData.forEach((location, index) => {
    const marker = L.marker([location.lat, location.lon]).addTo(map);
    
    marker.bindPopup(`
      <div style="text-align: center; min-width: 200px;">
        <h3 style="margin: 0 0 10px 0; color: #333;">${location.name}</h3>
        <p style="margin: 5px 0; color: #666;">${location.description}</p>
        <div style="margin: 10px 0;">
          <span class="category-badge" style="background-color: ${categoryColors[location.category] || categoryColors['Dal≈°√≠']}">
            ${location.category}
          </span>
        </div>
      </div>
    `);
    
    // P≈ô√≠m√© otev≈ôen√≠ VR p≈ôi kliknut√≠ na marker
    marker.on('click', () => openVRViewDirectly(location));
  });
}

// P≈ô√≠m√© otev≈ôen√≠ VR bez zobrazen√≠ detailu
function openVRViewDirectly(location) {
  document.getElementById('selectedLocation').textContent = location.name;
  
  // Aktualizace imageContainer pro p≈ô√≠pad n√°vratu z VR
  const imageContainer = document.getElementById('imageContainer');
  imageContainer.innerHTML = `
    <div class="location-info">
      <h2 style="color: #333; margin-top: 0;">${location.name}</h2>
      <div class="coordinates">
        üìç ${location.lat.toFixed(4)}, ${location.lon.toFixed(4)}
      </div>
      <div style="margin: 10px 0;">
        <span class="category-badge" style="background-color: ${categoryColors[location.category] || categoryColors['Dal≈°√≠']}">
          ${location.category}
        </span>
      </div>
      <p style="color: #666; line-height: 1.6;">${location.description}</p>
      <img src="${location.image}" 
           alt="${location.name}" 
           style="max-width: 100%; max-height: 400px; height: auto; 
                  border: 2px solid #dee2e6; border-radius: 8px; 
                  box-shadow: 0 4px 8px rgba(0,0,0,0.1); cursor: pointer;"
           onclick="openVRView('${location.image}')"
           onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
      <div style="display: none; color: #dc3545; padding: 20px; 
                  background: #f8d7da; border: 1px solid #f5c6cb; 
                  border-radius: 5px; margin: 10px 0;">
        ‚ö†Ô∏è Obr√°zek se nepoda≈ôilo naƒç√≠st: ${location.image}
      </div>
    </div>
  `;
  
  // Okam≈æit√© otev≈ôen√≠ VR
  openVRView(location.image);
}

// VR funkce s immersive m√≥dem
async function openVRView(imagePath) {
  const vrContainer = document.getElementById('vrContainer');
  const stereoContainer = vrContainer.querySelector('.stereo-container');
  

  // Vytvo≈ôen√≠ stereo-img elementu se spr√°vnou syntax√≠
  stereoContainer.innerHTML = `<stereo-img src="${imagePath}"></stereo-img>`;
  
  // Zobrazen√≠ VR kontejneru
  vrContainer.classList.add('active');
  
  // Zamezen√≠ scrollov√°n√≠ str√°nky
  document.body.style.overflow = 'hidden';
  
  // Pokus o spu≈°tƒõn√≠ immersive VR m√≥du pro Meta Quest
  try {
    if (navigator.xr) {
      const session = await navigator.xr.requestSession('immersive-vr');
      console.log('VR session started');
      
      // Posluchaƒç pro ukonƒçen√≠ VR session
      session.addEventListener('end', () => {
        exitVR();
      });
    }
  } catch (error) {
    console.log('Immersive VR not available, using regular stereo view:', error);
  }
}

function exitVR() {
  const vrContainer = document.getElementById('vrContainer');
  
  // Skryt√≠ VR kontejneru
  vrContainer.classList.remove('active');
  
  // Obnoven√≠ scrollov√°n√≠ str√°nky
  document.body.style.overflow = 'auto';
  
  // Vyƒçi≈°tƒõn√≠ stereo vieweru
  const stereoContainer = vrContainer.querySelector('.stereo-container');
  stereoContainer.innerHTML = '';
  
  // Ukonƒçen√≠ VR session pokud existuje
  if (navigator.xr) {
    navigator.xr.getSession().then(session => {
      if (session) {
        session.end();
      }
    }).catch(() => {
      // Session neexistuje nebo ji≈æ byla ukonƒçena
    });
  }
}

// Posluchaƒçe pro Meta Quest ovladaƒçe
document.addEventListener('keydown', function(event) {
  // Escape kl√°vesa
  if (event.key === 'Escape') {
    const vrContainer = document.getElementById('vrContainer');
    if (vrContainer.classList.contains('active')) {
      exitVR();
    }
  }
});

// Gamepad API pro Meta Quest ovladaƒçe
window.addEventListener('gamepadconnected', function(e) {
  console.log('Gamepad connected:', e.gamepad);
});

function checkGamepadInput() {
  const gamepads = navigator.getGamepads();
  
  for (let i = 0; i < gamepads.length; i++) {
    const gamepad = gamepads[i];
    if (gamepad) {
      // Tlaƒç√≠tko X na Meta Quest ovladaƒçi (obvykle button index 3)
      if (gamepad.buttons[3] && gamepad.buttons[3].pressed) {
        const vrContainer = document.getElementById('vrContainer');
        if (vrContainer.classList.contains('active')) {
          exitVR();
        }
      }
      
      // Alternativnƒõ tak√© menu tlaƒç√≠tko (button index 6)
      if (gamepad.buttons[6] && gamepad.buttons[6].pressed) {
        const vrContainer = document.getElementById('vrContainer');
        if (vrContainer.classList.contains('active')) {
          exitVR();
        }
      }
    }
  }
}

// Pravideln√° kontrola gamepad inputu
setInterval(checkGamepadInput, 100);

// WebXR posluchaƒçe pro Meta Quest
if (navigator.xr) {
  navigator.xr.addEventListener('devicechange', () => {
    console.log('XR device changed');
  });
}

// Inicializace p≈ôi naƒçten√≠ str√°nky
document.addEventListener('DOMContentLoaded', function() {
  initMap();
  loadData();
  
  // Kontrola WebXR podpory
  if (navigator.xr) {
    navigator.xr.isSessionSupported('immersive-vr').then(supported => {
      if (supported) {
        console.log('Immersive VR is supported');


      } else {
        console.log('Immersive VR is not supported');
      }
    });
  } else {
    console.log('WebXR is not supported');
  }
});

// Responsive behavior
window.addEventListener('resize', function() {
  if (map) {
    map.invalidateSize();
  }
});

// Touch ud√°losti pro mobiln√≠ za≈ô√≠zen√≠ (Meta Quest browser)
let touchStartTime = 0;
document.addEventListener('touchstart', function(e) {
  touchStartTime = Date.now();
});

document.addEventListener('touchend', function(e) {
  const touchDuration = Date.now() - touchStartTime;
  const vrContainer = document.getElementById('vrContainer');
  
  // Dlouh√© stisknut√≠ (1+ sekunda) pro exit z VR
  if (touchDuration > 1000 && vrContainer.classList.contains('active')) {
    exitVR();
  }
});

// Dodateƒçn√° podpora pro Meta Quest specifick√© ud√°losti
document.addEventListener('selectstart', function(e) {
  const vrContainer = document.getElementById('vrContainer');
  if (vrContainer.classList.contains('active')) {
    e.preventDefault();
    exitVR();
  }
});

// Podpora pro motion controllers
function handleControllerInput(event) {
  if (event.detail && event.detail.buttonPressed) {
    const vrContainer = document.getElementById('vrContainer');
    if (vrContainer.classList.contains('active')) {
      // X button nebo menu button
      if (event.detail.buttonIndex === 3 || event.detail.buttonIndex === 6) {
        exitVR();
      }
    }
  }
}

// Posluchaƒç pro custom controller ud√°losti
document.addEventListener('controllerinput', handleControllerInput);

// Fallback pro star≈°√≠ Meta Quest browsers
document.addEventListener('vrdisplaypresentchange', function(event) {
  if (!event.display.isPresenting) {
    exitVR();
  }
});
</script>
</body>
</html>












	    
	
	  
	  
