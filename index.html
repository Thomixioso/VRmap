<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mapa zaj√≠mav√Ωch m√≠st</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script type="module" src="https://stereo-img.steren.fr/stereo-img.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background-color: #f5f5f5;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    overflow: hidden;
  }
  
  .header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    text-align: center;
  }
  
  .stats {
    padding: 15px;
    background: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
    text-align: center;
  }
  
  .stat-item {
    display: inline-block;
    margin: 0 15px;
    padding: 5px 10px;
    background: white;
    border-radius: 5px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  #map { 
    height: 65vh; 
    width: 100%; 
  }
  
  #imageContainer { 
    padding: 20px;
    text-align: center;
    min-height: 250px;
    background: #f8f9fa;
  }
  
  #imageContainer img { 
    max-width: 100%; 
    max-height: 400px;
    height: auto; 
    border: 2px solid #dee2e6;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  
  .location-info {
    background: white;
    padding: 20px;
    margin: 10px auto;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    max-width: 600px;
  }
  
  .coordinates {
    color: #6c757d;
    font-size: 0.9em;
    margin: 10px 0;
    font-family: monospace;
    background: #f1f1f1;
    padding: 5px 8px;
    border-radius: 3px;
    display: inline-block;
  }
  
  .category-badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.8em;
    font-weight: bold;
    color: white;
    margin: 5px 0;
  }
  
  .error-message {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
    padding: 15px;
    border-radius: 5px;
    margin: 20px;
  }
  
  .loading {
    text-align: center;
    padding: 20px;
    color: #6c757d;
  }
  
  /* VR Stereo viewer styles */
  #vrContainer {
    display: none; /* ve v√Ωchoz√≠m stavu skryto */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: black;
    z-index: 10000;
  }
  
  #vrContainer.active {
    display: block; /* kdy≈æ je aktivn√≠ vr */
  }
  
  .vr-controls {
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 10001;
    display: none; /* v√Ωchoz√≠ skryto */
  }
  
  #vrContainer.active .vr-controls {
    display: block; /* zobrazit p≈ôi aktivn√≠ VR */
  }
  
  .vr-exit-btn {
    background: #dc3545;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  
  .vr-exit-btn:hover {
    background: #c82333;
  }
  
  .stereo-container {
    width: 100%;
    height: 100%;
  }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üó∫Ô∏è Mapa zaj√≠mav√Ωch m√≠st</h1>
    <p>Prozkoumejte zaj√≠mav√° m√≠sta po cel√©m svƒõtƒõ</p>
  </div>
  
  <div class="stats">
    <div class="stat-item">
      <strong id="totalLocations">0</strong>
      <div>Celkem m√≠st</div>
    </div>
    <div class="stat-item">
      <strong id="selectedLocation">≈Ω√°dn√©</strong>
      <div>Vybran√© m√≠sto</div>
    </div>
  </div>
  
  <div id="map"></div>
  
  <div id="imageContainer">
    <div class="loading">üåç Kliknƒõte na marker na mapƒõ pro zobrazen√≠ informac√≠ a obr√°zku</div>
  </div>
</div>

<!-- VR Container -->
<div id="vrContainer">
  <div class="vr-controls">
    <button class="vr-exit-btn" onclick="exitVR()">Exit VR</button>
  </div>
  <div class="stereo-container"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let map;
let markersData = [];

// Kategorie s barvami
const categoryColors = {
  'P≈ô√≠rodn√≠ pam√°tka': '#28a745',
  'Historick√° pam√°tka': '#dc3545', 
  'Mƒõsto': '#007bff',
  'Hrad': '#6f42c1',
  'Chr√°m': '#fd7e14',
  'Dal≈°√≠': '#6c757d'
};

// Inicializace mapy
function initMap() {
  map = L.map('map').setView([50.0755, 14.4378], 6);
  
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap contributors'
  }).addTo(map);
}

// Naƒçten√≠ dat
async function loadData() {
  try {
    const response = await fetch('data.json');
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    const data = await response.json();
    markersData = data; // P≈ô√≠mo pole dat
    
    updateStats();
    addMarkersToMap();
    
  } catch (error) {
    console.error('Chyba p≈ôi naƒç√≠t√°n√≠ dat:', error);
    document.getElementById('imageContainer').innerHTML = 
      `<div class="error-message">
        <strong>Chyba p≈ôi naƒç√≠t√°n√≠ dat:</strong> ${error.message}
        <br>Zkontrolujte, zda existuje soubor data.json ve stejn√© slo≈æce.
      </div>`;
  }
}

// Aktualizace statistik
function updateStats() {
  document.getElementById('totalLocations').textContent = markersData.length;
}

// P≈ôid√°n√≠ marker≈Ø na mapu
function addMarkersToMap() {
  markersData.forEach((location, index) => {
    const marker = L.marker([location.lat, location.lon]).addTo(map);
    marker.bindPopup(`
      <div style="text-align: center; min-width: 200px;">
        <h3 style="margin: 0 0 10px 0; color: #333;">${location.name}</h3>
        <p style="margin: 5px 0; color: #666;">${location.description}</p>
        <div style="margin: 10px 0;">
          <span class="category-badge" style="background-color: ${categoryColors[location.category] || categoryColors['Dal≈°√≠']}">
            ${location.category}
          </span>
        </div>
        <button onclick="showLocationDetails(${index})" 
                style="background: #007bff; color: white; border: none; padding: 8px 16px; 
                       border-radius: 4px; cursor: pointer; margin-top: 10px;">
          Zobrazit detail
        </button>
      </div>
    `);
    marker.on('click', () => showLocationDetails(index));
  });
}

// Zobrazen√≠ detailu
function showLocationDetails(index) {
  const location = markersData[index];
  if (!location) return;
  
  document.getElementById('selectedLocation').textContent = location.name;
  const imageContainer = document.getElementById('imageContainer');
  imageContainer.innerHTML = `
    <div class="location-info">
      <h2 style="color: #333; margin-top: 0;">${location.name}</h2>
      <div class="coordinates">
        üìç ${location.lat.toFixed(4)}, ${location.lon.toFixed(4)}
      </div>
      <div style="margin: 10px 0;">
        <span class="category-badge" style="background-color: ${categoryColors[location.category] || categoryColors['Dal≈°√≠']}">
          ${location.category}
        </span>
      </div>
      <p style="color: #666; line-height: 1.6;">${location.description}</p>
      <img src="${location.image}" 
           alt="${location.name}" 
           style="max-width: 100%; max-height: 400px; height: auto; 
                  border: 2px solid #dee2e6; border-radius: 8px; 
                  box-shadow: 0 4px 8px rgba(0,0,0,0.1); cursor: pointer;"
           onclick="openVRView('${location.image}')"
           onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
      <div style="display: none; color: #dc3545; padding: 20px; 
                  background: #f8d7da; border: 1px solid #f5c6cb; 
                  border-radius: 5px; margin: 10px 0;">
        ‚ö†Ô∏è Obr√°zek se nepoda≈ôilo naƒç√≠st: ${location.image}
      </div>
    </div>
  `;
  // Automaticky otev≈ô√≠t VR p≈ôi zobrazen√≠ detailu
  openVRView(location.image);
}

// Funkce pro zobrazen√≠ VR
function openVRView(imagePath) {
  const vrContainer = document.getElementById('vrContainer');
  const stereoContainer = vrContainer.querySelector('.stereo-container');
  stereoContainer.innerHTML = `<stereo-img src="${imagePath}"></stereo-img>`;
  vrContainer.classList.add('active');
  // Zobrazit tlaƒç√≠tko Exit VR v≈ædy, kdy≈æ je aktivn√≠
  // (ji≈æ je nastaven√© v CSS, ≈æe p≈ôi active je viditeln√©)
  // P≈ôidat posluchaƒç na gamepady pro ukonƒçen√≠ VR
  window.requestAnimationFrame(checkGamepads);
}

// Funkce pro ukonƒçen√≠ VR
function exitVR() {
  const vrContainer = document.getElementById('vrContainer');
  vrContainer.classList.remove('active');
  // Vyƒçistit stereo obsah
  const stereoContainer = vrContainer.querySelector('.stereo-container');
  stereoContainer.innerHTML = '';
}

// Kontrola gamepad≈Ø
function checkGamepads() {
  const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];
  for (let gp of gamepads) {
    if (gp) {
      // X, Y, A, B jsou tlaƒç√≠tka 0-3 v r≈Øzn√Ωch gamepadech
      // P≈ô√≠klad, pokud jsou stisknut√©
      // (p≈ôizp≈Øsobte podle sv√©ho ovladaƒçe)
      if (gp.buttons[0]?.pressed || // A
          gp.buttons[1]?.pressed || // B
          gp.buttons[2]?.pressed || // X
          gp.buttons[3]?.pressed) { // Y
        exitVR();
        break;
      }
    }
  }
  // Opƒõt kontrolovat ka≈æd√Ω frame
  if (document.querySelector('#vrContainer').classList.contains('active')) {
    window.requestAnimationFrame(checkGamepads);
  }
}

// P≈ôidat posluchaƒç na kl√°vesu Escape
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    const vrContainer = document.getElementById('vrContainer');
    if (vrContainer.classList.contains('active')) {
      exitVR();
    }
  }
});

// Inicializace
document.addEventListener('DOMContentLoaded', function() {
  initMap();
  loadData();
});

// Funkce pro naƒç√≠t√°n√≠ mapy
function initMap() {
  map = L.map('map').setView([50.0755, 14.4378], 6);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap contributors'
  }).addTo(map);
}

// Naƒç√≠st data
async function loadData() {
  try {
    const response = await fetch('data.json');
    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
    const data = await response.json();
    markersData = data;
    updateStats();
    addMarkersToMap();
  } catch (error) {
    document.getElementById('imageContainer').innerHTML =
      `<div class="error-message">
        <strong>Chyba p≈ôi naƒç√≠t√°n√≠ dat:</strong> ${error.message}
        <br>Zkontrolujte, zda existuje soubor data.json ve stejn√© slo≈æce.
      </div>`;
  }
}

function updateStats() {
  document.getElementById('totalLocations').textContent = markersData.length;
}

function addMarkersToMap() {
  markersData.forEach((location, index) => {
    const marker = L.marker([location.lat, location.lon]).addTo(map);
    marker.bindPopup(`
      <div style="text-align: center; min-width: 200px;">
        <h3 style="margin: 0 0 10px 0; color: #333;">${location.name}</h3>
        <p style="margin: 5px 0; color: #666;">${location.description}</p>
        <div style="margin: 10px 0;">
          <span class="category-badge" style="background-color: ${categoryColors[location.category] || categoryColors['Dal≈°√≠']}">
            ${location.category}
          </span>
        </div>
        <button onclick="showLocationDetails(${index})" 
                style="background: #007bff; color: white; border: none; padding: 8px 16px; 
                       border-radius: 4px; cursor: pointer; margin-top: 10px;">
          Zobrazit detail
        </button>
      </div>
    `);
    marker.on('click', () => showLocationDetails(index));
  });
}

function showLocationDetails(index) {
  const location = markersData[index];
  if (!location) return;
  document.getElementById('selectedLocation').textContent = location.name;
  const imageContainer = document.getElementById('imageContainer');
  imageContainer.innerHTML = `
    <div class="location-info">
      <h2 style="color: #333; margin-top: 0;">${location.name}</h2>
      <div class="coordinates">
        üìç ${location.lat.toFixed(4)}, ${location.lon.toFixed(4)}
      </div>
      <div style="margin: 10px 0;">
        <span class="category-badge" style="background-color: ${categoryColors[location.category] || categoryColors['Dal≈°√≠']}">
          ${location.category}
        </span>
      </div>
      <p style="color: #666; line-height: 1.6;">${location.description}</p>
      <img src="${location.image}" 
           alt="${location.name}" 
           style="max-width: 100%; max-height: 400px; height: auto; 
                  border: 2px solid #dee2e6; border-radius: 8px; 
                  box-shadow: 0 4px 8px rgba(0,0,0,0.1); cursor: pointer;"
           onclick="openVRView('${location.image}')"
           onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
      <div style="display: none; color: #dc3545; padding: 20px; 
                  background: #f8d7da; border: 1px solid #f5c6cb; 
                  border-radius: 5px; margin: 10px 0;">
        ‚ö†Ô∏è Obr√°zek se nepoda≈ôilo naƒç√≠st: ${location.image}
      </div>
    </div>
  `;
  // Automaticky otev≈ô√≠t VR p≈ôi zobrazen√≠ detailu
  openVRView(location.image);
}

function openVRView(imagePath) {
  const vrContainer = document.getElementById('vrContainer');
  const stereoContainer = vrContainer.querySelector('.stereo-container');
  stereoContainer.innerHTML = `<stereo-img src="${imagePath}"></stereo-img>`;
  vrContainer.classList.add('active');
  // Ovl√°d√°n√≠ p≈ôes gamepady bude aktivn√≠
  window.requestAnimationFrame(checkGamepads);
}

function exitVR() {
  const vrContainer = document.getElementById('vrContainer');
  vrContainer.classList.remove('active');
  const stereoContainer = vrContainer.querySelector('.stereo-container');
  stereoContainer.innerHTML = '';
}
</script>
</body>
</html>
