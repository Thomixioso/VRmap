<html>
  <head>
    <meta charset="utf-8">
    <title>180° SBS Stereo WebXR</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene vr-mode-ui="enabled: true"
             xr-webxr="referenceSpaceType: local"  <!-- kamera přesně v centru -->

             background="color: black">

      <!-- Kamera -->
      <a-entity id="cameraRig">
        <a-entity camera look-controls position="0 0 0"></a-entity>
      </a-entity>

      <!-- Levé oko -->
      <a-entity id="sphereLeft"
                geometry="primitive: sphere; radius: 10; segmentsWidth: 64; segmentsHeight: 64; thetaLength: 180"
                material="side: back; src: #stereoImage; repeat: 0.5 1; offset: 0 0"
                stereo="eye: left">
      </a-entity>

      <!-- Pravé oko -->
      <a-entity id="sphereRight"
                geometry="primitive: sphere; radius: 10; segmentsWidth: 64; segmentsHeight: 64; thetaLength: 180"
                material="side: back; src: #stereoImage; repeat: 0.5 1; offset: 0.5 0"
                stereo="eye: right">
      </a-entity>

      <!-- Jeden společný obrázek -->
      <a-assets>
        <img id="stereoImage" src="./Castles/generated/Le_Castillet_generated.jpg">
      </a-assets>

      <!-- Skript pro přizpůsobení segmentů -->
      <script>
        document.querySelector('#stereoImage').addEventListener('load', function (e) {
          const img = e.target;
          const halfAspect = (img.naturalWidth / 2) / img.naturalHeight; // poměr pro jedno oko
          const radius = 10;
          const segW = Math.max(32, Math.round(halfAspect * 64));

          ['#sphereLeft', '#sphereRight'].forEach(sel => {
            document.querySelector(sel).setAttribute('geometry', {
              primitive: 'sphere',
              radius: radius,
              segmentsWidth: segW,
              segmentsHeight: 64,
              thetaLength: 180
            });
          });

          console.log(`✅ Nastaveno pro aspect ratio jednoho oka: ${halfAspect.toFixed(3)}`);
        });
      </script>

    </a-scene>
  </body>
</html>
