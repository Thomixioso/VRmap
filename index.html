<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <style>
      #ui {
        position: fixed;
        z-index: 100;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.8);
        padding: 15px;
        border-radius: 8px;
        font-family: Arial, sans-serif;
      }
      #ui button {
        margin: 5px;
        padding: 12px 18px;
        background: #4CC3D9;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
      }
      #ui button:hover {
        background: #7BC8E8;
      }
      #ui button:disabled {
        background: #666;
        cursor: not-allowed;
      }
      #info {
        position: fixed;
        z-index: 1000;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
        background: rgba(0,0,0,0.9);
        color: white;
        padding: 15px;
        border-radius: 8px;
        font-family: Arial, sans-serif;
      }
      #stereoToggle {
        background: #EF2D5E !important;
      }
      #stereoToggle:hover {
        background: #F56990 !important;
      }
      #stereoToggle.active {
        background: #43A047 !important;
      }
      .stereo-warning {
        color: #FFA726;
        font-size: 12px;
        margin-top: 5px;
      }
    </style>
    <script>
    AFRAME.registerComponent('stereo-viewer', {
      schema: {
        stereoMode: {type: 'boolean', default: false}
      },
      
      init: function() {
        this.sphere = this.el.querySelector('.vr-sphere');
        this.camera = this.el.querySelector('[camera]');
        this.isStereoMode = false;
        
        // Inicialn√≠ nastaven√≠ pro mono zobrazen√≠ (pln√Ω obr√°zek)
        this.setMonoMode();
      },
      
      setMonoMode: function() {
        // Zobrazujeme cel√Ω obr√°zek (obƒõ strany SBS)
        this.sphere.setAttribute('material', {
          repeat: {x: 1, y: 1},
          offset: {x: 0, y: 0}
        });
        this.isStereoMode = false;
        
        // Obnoven√≠ norm√°ln√≠ kamery
        this.camera.setAttribute('camera', 'active', true);
      },
      
      setStereoMode: function() {
        // Zobrazujeme pouze levou polovinu pro demo stereo efektu
        this.sphere.setAttribute('material', {
          repeat: {x: 0.5, y: 1},
          offset: {x: 0, y: 0}
        });
        this.isStereoMode = true;
      },
      
      toggleStereo: function() {
        if (this.isStereoMode) {
          this.setMonoMode();
        } else {
          this.setStereoMode();
        }
        return this.isStereoMode;
      }
    });

    AFRAME.registerComponent('gallery-controller', {
      init: function() {
        this.currentImageIndex = 0;
        this.images = [
          {
            src: './Castles/generated/Le_Castillet_generated.jpg',
            name: 'Le Castillet'
          },
          {
            src: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/Stereoscopic_postcard_of_the_Geneva_synagogue.jpg/800px-Stereoscopic_postcard_of_the_Geneva_synagogue.jpg',
            name: 'Geneva Synagogue'
          }
        ];
        
        this.stereoViewer = this.el.components['stereo-viewer'];
        
        // Naƒçten√≠ prvn√≠ho obr√°zku
        this.loadImage(this.currentImageIndex);
        
        // Event listenery
        document.getElementById('prevBtn').addEventListener('click', () => {
          this.previousImage();
        });
        
        document.getElementById('nextBtn').addEventListener('click', () => {
          this.nextImage();
        });
        
        document.getElementById('stereoToggle').addEventListener('click', () => {
          this.toggleStereo();
        });
        
        document.getElementById('fullscreenBtn').addEventListener('click', () => {
          this.enterFullscreen();
        });
        
        // Kontrola WebXR podpory
        this.checkWebXRSupport();
      },
      
      loadImage: function(index) {
        const sphere = this.el.querySelector('.vr-sphere');
        const imageData = this.images[index];
        
        // Aktualizace textury
        sphere.setAttribute('material', 'src', imageData.src);
        
        // Aktualizace UI
        document.getElementById('imageCounter').textContent = 
          `${imageData.name} (${index + 1}/${this.images.length})`;
        
        // Obnoven√≠ mono m√≥du p≈ôi zmƒõnƒõ obr√°zku
        this.stereoViewer.setMonoMode();
        this.updateStereoButton(false);
      },
      
      nextImage: function() {
        this.currentImageIndex = (this.currentImageIndex + 1) % this.images.length;
        this.loadImage(this.currentImageIndex);
      },
      
      previousImage: function() {
        this.currentImageIndex = this.currentImageIndex === 0 ? 
          this.images.length - 1 : this.currentImageIndex - 1;
        this.loadImage(this.currentImageIndex);
      },
      
      toggleStereo: function() {
        const isStereo = this.stereoViewer.toggleStereo();
        this.updateStereoButton(isStereo);
      },
      
      updateStereoButton: function(isStereo) {
        const button = document.getElementById('stereoToggle');
        if (isStereo) {
          button.textContent = 'üëÅÔ∏è Mono zobrazen√≠';
          button.classList.add('active');
        } else {
          button.textContent = 'ü•Ω Stereo m√≥d';
          button.classList.remove('active');
        }
      },
      
      enterFullscreen: function() {
        const sceneEl = document.querySelector('a-scene');
        if (sceneEl.requestFullscreen) {
          sceneEl.requestFullscreen();
        } else if (sceneEl.webkitRequestFullscreen) {
          sceneEl.webkitRequestFullscreen();
        } else if (sceneEl.msRequestFullscreen) {
          sceneEl.msRequestFullscreen();
        }
      },
      
      checkWebXRSupport: function() {
        if (!navigator.xr) {
          document.getElementById('webxrStatus').textContent = 
            'WebXR nen√≠ podporov√°n v tomto prohl√≠≈æeƒçi';
          return;
        }
        
        navigator.xr.isSessionSupported('immersive-vr').then((supported) => {
          if (supported) {
            document.getElementById('webxrStatus').textContent = 
              'WebXR VR je podporov√°n! üéâ';
          } else {
            document.getElementById('webxrStatus').textContent = 
              'WebXR je dostupn√Ω, ale VR nen√≠ podporov√°n na tomto za≈ô√≠zen√≠';
          }
        }).catch(() => {
          document.getElementById('webxrStatus').textContent = 
            'Probl√©m s detekc√≠ WebXR podpory';
        });
      }
    });
    </script>
  </head>
  <body>
    <div id="info">
      <h3>180¬∞ VR Stereo Galerie</h3>
      <p id="imageCounter">Le Castillet (1/2)</p>
      <p id="webxrStatus">Kontroluji WebXR podporu...</p>
      <div class="stereo-warning">
        üí° Stereo m√≥d zobrazuje pouze levou ƒç√°st SBS obr√°zku pro demonstraci
      </div>
    </div>
    
    <div id="ui">
      <button id="prevBtn">‚óÄ P≈ôedchoz√≠</button>
      <button id="stereoToggle">ü•Ω Stereo m√≥d</button>
      <button id="nextBtn">Dal≈°√≠ ‚ñ∂</button>
      <button id="fullscreenBtn">‚õ∂ Cel√° obrazovka</button>
    </div>

    <a-scene 
      background="color: #000000"
      vr-mode-ui="enabled: false"
      renderer="antialias: true; colorManagement: true"
      embedded
      style="height: 100vh; width: 100vw;">
      
      <a-assets>
        <img id="currentImage" src="./Castles/generated/Le_Castillet_generated.jpg" crossorigin="anonymous">
      </a-assets>

      <!-- Hlavn√≠ entita s komponentami -->
      <a-entity 
        stereo-viewer
        gallery-controller
        position="0 1.6 0">
        
        <!-- Kamera s look controls -->
        <a-camera 
          look-controls="enabled: true; reverseMouseDrag: false"
          wasd-controls="enabled: false"
          cursor="rayOrigin: mouse"
          position="0 0 0">
        </a-camera>
      </a-entity>

      <!-- 180¬∞ sf√©ra -->
      <a-sphere 
        class="vr-sphere"
        material="src: #currentImage; side: back"
        radius="50" 
        theta-start="0" 
        theta-length="180"
        position="0 0 0">
      </a-sphere>

      <!-- Ambientn√≠ osvƒõtlen√≠ -->
      <a-light type="ambient" color="#ffffff" intensity="0.6"></a-light>
    </a-scene>
  </body>
</html>
