<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <style>
      #ui {
        position: fixed;
        z-index: 100;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.7);
        padding: 10px;
        border-radius: 5px;
      }
      #ui button {
        margin: 5px;
        padding: 10px 15px;
        background: #4CC3D9;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
      }
      #ui button:hover {
        background: #7BC8E8;
      }
      #info {
        position: fixed;
        z-index: 1000;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 10px;
        border-radius: 5px;
      }
    </style>
    <script>
    AFRAME.registerComponent('stereo-180', {
      schema: {
        eye: {type: 'string', default: 'left'}
      },
      init: function () {
        // Pro lev√© oko pou≈æ√≠v√°me levou polovinu textury
        // Pro prav√© oko pou≈æ√≠v√°me pravou polovinu textury
        if (this.data.eye === 'left') {
          this.el.setAttribute('material', {
            repeat: {x: 0.5, y: 1},
            offset: {x: 0, y: 0}
          });
        } else {
          this.el.setAttribute('material', {
            repeat: {x: 0.5, y: 1},
            offset: {x: 0.5, y: 0}
          });
        }
        
        // Nastaven√≠ vrstvy pro stereo rendering
        this.el.setAttribute('layer', {
          type: this.data.eye === 'left' ? 'monovision' : 'monovision'
        });
      }
    });

    AFRAME.registerComponent('vr-gallery-controller', {
      init: function() {
        this.currentImageIndex = 0;
        this.images = [
          './Castles/generated/Le_Castillet_generated.jpg',
          'assets/default180_1.jpg',
          'assets/default180_2.jpg'
        ];
        
        // Inicializace s prvn√≠m obr√°zkem
        this.loadImage(this.currentImageIndex);
        
        // Event listenery pro tlaƒç√≠tka
        document.getElementById('prevBtn').addEventListener('click', () => {
          this.previousImage();
        });
        
        document.getElementById('nextBtn').addEventListener('click', () => {
          this.nextImage();
        });
        
        document.getElementById('vrBtn').addEventListener('click', () => {
          this.enterVR();
        });
      },
      
      loadImage: function(index) {
        const spheres = document.querySelectorAll('.vr-sphere');
        const imageSrc = this.images[index];
        
        // Aktualizace textury pro obƒõ koule (lev√© a prav√© oko)
        spheres.forEach(sphere => {
          sphere.setAttribute('material', 'src', imageSrc);
        });
        
        // Aktualizace info
        document.getElementById('imageCounter').textContent = 
          `Obr√°zek ${index + 1} z ${this.images.length}`;
      },
      
      nextImage: function() {
        this.currentImageIndex = (this.currentImageIndex + 1) % this.images.length;
        this.loadImage(this.currentImageIndex);
      },
      
      previousImage: function() {
        this.currentImageIndex = this.currentImageIndex === 0 ? 
          this.images.length - 1 : this.currentImageIndex - 1;
        this.loadImage(this.currentImageIndex);
      },
      
      enterVR: function() {
        if (!this.el.sceneEl.is('vr-mode')) {
          this.el.sceneEl.enterVR();
        }
      }
    });
    </script>
  </head>
  <body>
    <div id="info">
      <h3>180¬∞ VR Stereo Galerie</h3>
      <p id="imageCounter">Obr√°zek 1 z 3</p>
      <p>Pou≈æijte VR headset nebo Google Cardboard pro nejlep≈°√≠ z√°≈æitek</p>
    </div>
    
    <div id="ui">
      <button id="prevBtn">‚óÄ P≈ôedchoz√≠</button>
      <button id="vrBtn">ü•Ω Vstup do VR</button>
      <button id="nextBtn">Dal≈°√≠ ‚ñ∂</button>
    </div>

    <a-scene 
      vr-mode-ui="enabled: true" 
      background="color: #000000"
      renderer="antialias: true; colorManagement: true; sortObjects: true;"
      vive-controls="hand: left" 
      vive-controls="hand: right">
      
      <a-assets>
        <img id="currentImage" src="./Castles/generated/Le_Castillet_generated.jpg" crossorigin="anonymous">
      </a-assets>

      <!-- VR kamera s pozic√≠ uprost≈ôed -->
      <a-entity 
        id="cameraRig" 
        position="0 1.6 0"
        vr-gallery-controller>
        
        <!-- Lev√© oko - zobrazuje levou polovinu SBS obr√°zku -->
        <a-camera 
          id="leftEye"
          active="false"
          stereo="eye: left"
          look-controls="enabled: true; reverseMouseDrag: false"
          wasd-controls="enabled: false"
          position="-0.032 0 0">
        </a-camera>
        
        <!-- Prav√© oko - zobrazuje pravou polovinu SBS obr√°zku -->
        <a-camera 
          id="rightEye" 
          active="false"
          stereo="eye: right"
          look-controls="enabled: true; reverseMouseDrag: false"
          wasd-controls="enabled: false"
          position="0.032 0 0">
        </a-camera>
        
        <!-- Hlavn√≠ kamera pro non-VR m√≥d -->
        <a-camera 
          id="mainCamera"
          active="true"
          look-controls="enabled: true"
          wasd-controls="enabled: false">
        </a-camera>
      </a-entity>

      <!-- 180¬∞ sf√©ra pro lev√© oko -->
      <a-sphere 
        class="vr-sphere"
        material="src: #currentImage; side: back; repeat: 0.5 1; offset: 0 0"
        stereo-180="eye: left"
        radius="100" 
        theta-start="0" 
        theta-length="180"
        position="0 0 0"
        layer="type: monovision">
      </a-sphere>
      
      <!-- 180¬∞ sf√©ra pro prav√© oko -->
      <a-sphere 
        class="vr-sphere"
        material="src: #currentImage; side: back; repeat: 0.5 1; offset: 0.5 0"
        stereo-180="eye: right"
        radius="100" 
        theta-start="0" 
        theta-length="180" 
        position="0 0 0"
        layer="type: monovision">
      </a-sphere>

      <!-- Svƒõtlo pro lep≈°√≠ zobrazen√≠ -->
      <a-light type="ambient" color="#404040" intensity="0.4"></a-light>
    </a-scene>
  </body>
</html>
