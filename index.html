<html>
  <head>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene vr-mode-ui="enabled: true">

      <!-- Kamera -->
      <a-entity id="cameraRig">
        <a-entity camera look-controls position="0 0 0"></a-entity>
      </a-entity>

      <!-- Levé oko -->
      <a-entity id="sphereLeft"
                geometry="primitive: sphere; radius: 10; segmentsWidth: 64; segmentsHeight: 64; thetaLength: 180"
                material="side: back; src: #stereoImage; repeat: 0.5 1; offset: 0 0"
                stereo="eye: left">
      </a-entity>

      <!-- Pravé oko -->
      <a-entity id="sphereRight"
                geometry="primitive: sphere; radius: 10; segmentsWidth: 64; segmentsHeight: 64; thetaLength: 180"
                material="side: back; src: #stereoImage; repeat: 0.5 1; offset: 0.5 0"
                stereo="eye: right">
      </a-entity>

      <!-- Jeden společný obrázek -->
      <a-assets>
        <img id="stereoImage" src="./Castles/generated/Le_Castillet_generated.jpg">
      </a-assets>

      <!-- Skript pro přizpůsobení -->
      <script>
        document.querySelector('#stereoImage').addEventListener('load', function (e) {
          const img = e.target;
          const aspect = img.naturalWidth / img.naturalHeight;

          // protože máme SBS, šířku jedné půlky počítáme jako poloviční
          const halfAspect = (img.naturalWidth / 2) / img.naturalHeight;

          // radius určíme tak, aby projekce nebyla deformovaná
          // pro většinu headsetů funguje radius 10 + úprava segmentů
          const radius = 10;

          const sphereLeft = document.querySelector('#sphereLeft');
          const sphereRight = document.querySelector('#sphereRight');

          sphereLeft.setAttribute('geometry', {
            primitive: 'sphere',
            radius: radius,
            segmentsWidth: Math.max(32, Math.round(halfAspect * 64)),
            segmentsHeight: 64,
            thetaLength: 180
          });

          sphereRight.setAttribute('geometry', {
            primitive: 'sphere',
            radius: radius,
            segmentsWidth: Math.max(32, Math.round(halfAspect * 64)),
            segmentsHeight: 64,
            thetaLength: 180
          });

          console.log(`Texture aspect ratio: ${aspect}, half: ${halfAspect}`);
        });
      </script>
    </a-scene>
  </body>
</html>
