<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR Stereo Test - Insta 360 EVO - Meta Quest 3</title>
    
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
    
    <!-- Immersive Video Component - specializovan√° knihovna pro stereo 180/360 -->
    <script src="https://unpkg.com/aframe-immersive-video-component/dist/aframe-immersive-video-component.min.js"></script>
    
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        
        .ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            z-index: 1000;
            font-size: 14px;
        }
        
        .controls {
            margin-top: 10px;
        }
        
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .button:hover {
            background: #0056b3;
        }
        
        .debug {
            background: rgba(40, 40, 40, 0.9);
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        
        .format-options {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
        
        .format-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 3px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .format-btn.active {
            background: #007bff;
        }
    </style>
</head>
<body>
    <div class="ui-overlay" id="uiOverlay">
        <h3>ü•Ω VR Stereo Test - Insta 360 EVO - aframe-immersive-video</h3>
        <div class="info">
            <strong>Pou≈æito: aframe-immersive-video-component</strong><br>
            Specializovan√° knihovna pro stereo 180¬∞/360¬∞ obr√°zky a videa
        </div>
        
        <div class="format-options">
            <strong>Form√°ty pro test:</strong><br>
            <button class="format-btn active" onclick="changeFormat('180_stereo_horizontal')">180¬∞ Stereo L/R (Insta 360 EVO)</button>
            <button class="format-btn" onclick="changeFormat('180_mono_horizontal')">180¬∞ Mono</button>
            <button class="format-btn" onclick="changeFormat('360_stereo_horizontal')">360¬∞ Stereo L/R</button>
            <button class="format-btn" onclick="changeFormat('360_stereo_vertical')">360¬∞ Stereo T/B</button>
        </div>
        
        <div class="controls">
            <button class="button" onclick="loadVRScene()">üì∑ Naƒç√≠st VR sc√©nu</button>
            <button class="button" onclick="autoEnterVR()" id="autoVrBtn">üöÄ Auto VR</button>
            <button class="button" onclick="testImagePath()">üîç Test cesty k obr√°zku</button>
            <button class="button" onclick="toggleUI()">üëÅÔ∏è Skr√Ωt/Zobrazit UI</button>
        </div>
        
        <div id="debugOutput" class="debug"></div>
    </div>

    <!-- A-Frame VR sc√©na s immersive-video komponentou -->
    <a-scene 
        id="vrScene" 
        antialias="true"
        embedded 
        style="height: 100vh; width: 100%;"
        vr-mode-ui="enabled: true">
        
        <!-- Immersive video entity pro stereo 180¬∞ -->
        <a-entity 
            id="immersiveEntity"
            immersive-video="
                type: 180_stereo_horizontal; 
                source: Castles/generated/Le_Castillet_generated.jpg;
                controls: true;
                theme: dark;
                open: true
            ">
        </a-entity>
        
        <!-- Z√°kladn√≠ kamera -->
        <a-entity 
            camera 
            look-controls 
            position="0 1.6 0">
        </a-entity>
        
        <!-- Z√°kladn√≠ osvƒõtlen√≠ -->
        <a-light type="ambient" color="#404040"></a-light>
    </a-scene>

    <script>
        let sceneLoaded = false;
        let uiVisible = true;
        let currentFormat = '180_stereo_horizontal';
        
        // Debug funkce
        function debugLog(message, type = 'info') {
            const debugDiv = document.getElementById('debugOutput');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            debugDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            debugDiv.scrollTop = debugDiv.scrollHeight;
            console.log(message);
        }
        
        function changeFormat(format) {
            currentFormat = format;
            debugLog(`üîÑ Zmƒõna form√°tu na: ${format}`, 'info');
            
            // Aktualizovat aktivn√≠ tlaƒç√≠tko
            document.querySelectorAll('.format-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Aktualizovat immersive-video komponentu
            const entity = document.querySelector('#immersiveEntity');
            if (entity) {
                entity.setAttribute('immersive-video', {
                    type: format,
                    source: 'Castles/generated/Le_Castillet_generated.jpg',
                    controls: true,
                    theme: 'dark',
                    open: true
                });
                debugLog(`‚úÖ Form√°t aktualizov√°n na entity`, 'success');
            }
        }
        
        function loadVRScene() {
            debugLog('Naƒç√≠t√°m VR sc√©nu s immersive-video...', 'info');
            debugLog(`Aktu√°ln√≠ form√°t: ${currentFormat}`, 'info');
            
            const scene = document.querySelector('#vrScene');
            const entity = document.querySelector('#immersiveEntity');
            
            // Test existence obr√°zku
            const testImg = new Image();
            testImg.onload = () => {
                debugLog('‚úÖ Stereo obr√°zek naƒçten √∫spƒõ≈°nƒõ!', 'success');
                debugLog(`Rozmƒõry obr√°zku: ${testImg.width}x${testImg.height}`, 'info');
                debugLog(`üé• Insta 360 EVO: ${currentFormat} form√°t`, 'info');
                sceneLoaded = true;
                
                // Aktualizovat immersive-video src
                entity.setAttribute('immersive-video', 'source', testImg.src);
                
                // Auto-aktivovat VR tlaƒç√≠tko
                setTimeout(() => {
                    const vrButton = document.querySelector('.a-enter-vr');
                    if (vrButton) {
                        debugLog('‚úÖ A-Frame VR tlaƒç√≠tko je dostupn√©', 'success');
                        debugLog('ü•Ω Kliknƒõte na VR tlaƒç√≠tko pro stereo efekt!', 'info');
                    }
                }, 1000);
            };
            
            testImg.onerror = () => {
                debugLog('‚ùå CHYBA p≈ôi naƒç√≠t√°n√≠ obr√°zku!', 'error');
                debugLog('Zkontrolujte cestu: Castles/generated/Le_Castillet_generated.jpg', 'error');
                
                // Zkusit alternativn√≠ cestu
                debugLog('Zkou≈°√≠m alternativn√≠ cestu...', 'info');
                setTimeout(() => {
                    testImg.src = './Castles/generated/Le_Castillet_generated.jpg';
                }, 1000);
            };
            
            testImg.src = 'Castles/generated/Le_Castillet_generated.jpg';
            
            // Sledovat A-Frame eventy
            scene.addEventListener('loaded', () => {
                debugLog('‚úÖ A-Frame sc√©na naƒçtena', 'success');
            });
            
            scene.addEventListener('enter-vr', () => {
                debugLog('ü•Ω VSTUP DO VR RE≈ΩIMU - IMMERSIVE VIDEO AKTIVN√ç!', 'success');
                toggleUI(false); // Skr√Ωt UI ve VR
            });
            
            scene.addEventListener('exit-vr', () => {
                debugLog('üëã V√Ωstup z VR re≈æimu', 'info');
                toggleUI(true); // Zobrazit UI po VR
            });
            
            // Sledovat immersive-video eventy
            entity.addEventListener('componentinitialized', (evt) => {
                if (evt.detail.name === 'immersive-video') {
                    debugLog('‚úÖ Immersive-video komponenta inicializov√°na', 'success');
                }
            });
        }
        
        async function autoEnterVR() {
            debugLog('Pokou≈°√≠m se o automatick√Ω vstup do VR...', 'info');
            
            if (!sceneLoaded) {
                debugLog('‚ùå Nejd≈ô√≠ve naƒçtƒõte VR sc√©nu!', 'error');
                return;
            }
            
            try {
                const scene = document.querySelector('#vrScene');
                
                // Zkontrolovat WebXR podporu
                if (!navigator.xr) {
                    throw new Error('WebXR nen√≠ podporov√°no');
                }
                
                // Zkontrolovat VR session support
                const supported = await navigator.xr.isSessionSupported('immersive-vr');
                if (!supported) {
                    throw new Error('Immersive VR nen√≠ podporov√°no na tomto za≈ô√≠zen√≠');
                }
                
                debugLog('‚úÖ WebXR je podporov√°no, spou≈°t√≠m VR...', 'success');
                
                // Pokusit se o automatick√Ω vstup
                if (scene.enterVR) {
                    await scene.enterVR();
                    debugLog('üöÄ Automatick√Ω vstup do VR √∫spƒõ≈°n√Ω!', 'success');
                } else {
                    // Fallback - simulovat klik na VR tlaƒç√≠tko
                    const vrButton = document.querySelector('.a-enter-vr');
                    if (vrButton) {
                        vrButton.click();
                        debugLog('üîÑ Simuluji klik na VR tlaƒç√≠tko...', 'info');
                    } else {
                        throw new Error('VR tlaƒç√≠tko nenalezeno');
                    }
                }
                
            } catch (error) {
                debugLog(`‚ùå Auto VR selhalo: ${error.message}`, 'error');
                debugLog('üí° Zkuste kliknout na VR tlaƒç√≠tko v prav√©m doln√≠m rohu', 'info');
            }
        }
        
        function testImagePath() {
            debugLog('üîç Testuji cesty k obr√°zku...', 'info');
            
            const testPaths = [
                'Castles/generated/Le_Castillet_generated.jpg',
                './Castles/generated/Le_Castillet_generated.jpg',
                '../Castles/generated/Le_Castillet_generated.jpg',
                'data/Castles/generated/Le_Castillet_generated.jpg'
            ];
            
            testPaths.forEach((path, index) => {
                const testImg = new Image();
                testImg.onload = () => {
                    debugLog(`‚úÖ FUNGUJE: ${path} (${testImg.width}x${testImg.height})`, 'success');
                    
                    // Pokud je to prvn√≠ funkƒçn√≠ cesta, pou≈æij ji
                    if (!sceneLoaded) {
                        debugLog(`üîÑ Pou≈æ√≠v√°m cestu: ${path}`, 'info');
                        const entity = document.querySelector('#immersiveEntity');
                        entity.setAttribute('immersive-video', 'source', path);
                        setTimeout(() => loadVRScene(), 500);
                    }
                };
                testImg.onerror = () => {
                    debugLog(`‚ùå NEFUNGUJE: ${path}`, 'error');
                };
                testImg.src = path;
            });
        }
        
        function toggleUI(force = null) {
            const overlay = document.getElementById('uiOverlay');
            if (force !== null) {
                uiVisible = force;
            } else {
                uiVisible = !uiVisible;
            }
            
            overlay.style.display = uiVisible ? 'block' : 'none';
            debugLog(`UI ${uiVisible ? 'zobrazeno' : 'skryto'}`, 'info');
        }
        
        // Inicializace p≈ôi naƒçten√≠
        window.addEventListener('load', () => {
            debugLog('üöÄ Str√°nka naƒçtena', 'success');
            debugLog(`A-Frame verze: ${AFRAME.version}`, 'info');
            debugLog('üîß Pou≈æ√≠v√°m aframe-immersive-video-component', 'info');
            debugLog('üì± Optimalizov√°no pro Insta 360 EVO (180_stereo_horizontal)', 'info');
            
            // Zkontrolovat WebXR
            if (navigator.xr) {
                debugLog('‚úÖ WebXR je dostupn√Ω', 'success');
                navigator.xr.isSessionSupported('immersive-vr').then(supported => {
                    if (supported) {
                        debugLog('‚úÖ Immersive VR je podporov√°no!', 'success');
                        debugLog('üí° Kliknƒõte "Naƒç√≠st VR sc√©nu" ‚Üí pak VR tlaƒç√≠tko vpravo dole', 'info');
                    } else {
                        debugLog('‚ùå Immersive VR nen√≠ podporov√°no', 'error');
                    }
                });
            } else {
                debugLog('‚ùå WebXR nen√≠ dostupn√Ω', 'error');
            }
            
            // Auto-naƒçten√≠ sc√©ny po 2 sekund√°ch
            setTimeout(() => {
                debugLog('üîÑ Auto-naƒç√≠t√°m VR sc√©nu...', 'info');
                loadVRScene();
            }, 2000);
        });
        
        // Error handling
        window.addEventListener('error', (event) => {
            debugLog(`GLOB√ÅLN√ç CHYBA: ${event.message}`, 'error');
        });
        
        // Kl√°vesov√© zkratky
        document.addEventListener('keydown', (event) => {
            if (event.key === 'v' || event.key === 'V') {
                autoEnterVR();
            }
            if (event.key === 'u' || event.key === 'U') {
                toggleUI();
            }
        });
    </script>
</body>
</html>
